<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Paciente - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="../assets/css/pacientesDashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.css" rel="stylesheet" />

    <script src="../assets/js/loginPaciente.js" defer></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="https://mdbcdn.b-cdn.net/wp-content/uploads/2018/06/logo-mdb-jquery-small.png" alt="..."
                    height="36">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="#">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Ir a tu cita</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Mi Cuenta
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" id="saludoUsuario" href="./miPerfil.html">Perfil</a></li>
                            <li><a class="dropdown-item" href="./tuHistorial.html">Tu historial</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" id="btnCerrarSesion" href="#">Cerrar Sesión</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Content -->
    <div class="container">
        <h1 class="mt-4">Bienvenido a tu historial de citas</h1>
        <p>Aquí podrás ver tu historial de citas generadas a lo largo de tu historial medico</p>

    </div>
    <div class="container mt-5">
        <h3 class="mb-4">Historial de Citas</h3>

        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover align-middle shadow">
                <thead class="table-primary text-center">
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>DNI</th>
                        <th>Doctor</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                    </tr>
                </thead>
                <tbody id="tabla-citas" class="text-center">
                    <!-- Aquí se agregan las citas dinámicamente -->
                </tbody>
            </table>
        </div>
    </div>



    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const usuario = JSON.parse(localStorage.getItem('usuario'));

            console.log("Usuario cargado:", usuario); // <-- ¿Aparece el dni?

            if (usuario) {
                // Aquí sí llamamos a la función
                obtenerCitasPorDni(usuario.dni);
            } else {
                // Redirigir si no hay sesión activa
                window.location.href = "/pages/pacienteDashboard.html";
            }
        });

        async function obtenerCitasPorDni(dni) {
            try {
                console.log("Buscando citas para DNI:", dni); // debug
                const response = await fetch(`http://localhost:8080/api/citas/dni/${dni}`);
                const citas = await response.json();
                console.log("Citas encontradas:", citas); // debug

                const tabla = document.getElementById("tabla-citas");
                tabla.innerHTML = ""; // Limpiar antes de agregar nuevas

                if (citas.length === 0) {
                    tabla.innerHTML = `<tr><td colspan="8">No tienes citas registradas.</td></tr>`;
                    return;
                }

                citas.forEach(cita => {
                    const fila = document.createElement("tr");
                    fila.innerHTML = `
                    <td>${cita.id_cita}</td>
                    <td>${cita.nombre}</td>
                    <td>${cita.apellido}</td>
                    <td>${cita.dni}</td>
                    <td>${cita.doctor}</td>
                    <td>${cita.fecha}</td>
                    <td>${cita.hora}</td>
                `;
                    tabla.appendChild(fila);
                });
            } catch (error) {
                console.error("Error al obtener las citas del paciente:", error);
            }
        }

        // Cierre de sesión
        document.getElementById('btnCerrarSesion').addEventListener('click', () => {
            localStorage.removeItem('usuario');
            window.location.href = "../index.html";
        });
    </script>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous">
        </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.js"></script>





</html>